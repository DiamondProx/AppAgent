# Android 智能手机助手 使用说明

## 功能概述

这个Android应用提供了智能手机自动化控制功能，包含以下特性：

### 主界面功能
- **任务输入框**：输入需要执行的任务描述
- **执行任务按钮**：AI将根据描述自动完成任务（待实现）
- **测试按钮**：进入手动控制测试界面

### 设备控制功能
- **返回操作**：模拟系统返回按键
- **点击操作**：在指定坐标点击
- **长按操作**：在指定坐标长按
- **文本输入**：向当前焦点控件输入文本
- **滑动操作**：从起始坐标滑动到结束坐标
- **UI结构获取**：获取当前界面的XML结构信息
- **屏幕截图**：通过MediaProjection获取屏幕截图

## 使用前准备

### 自动权限检查
应用现在具备智能权限检查功能：
- **主界面权限状态**：实时显示无障碍权限状态
- **自动权限引导**：点击测试按钮时自动检查权限
- **一键设置跳转**：无权限时可直接跳转到设置页面

### 1. 启用无障碍服务
1. 在主界面查看权限状态卡片
2. 如显示"⚠ 无障碍权限未启用"，点击"去设置"按钮
3. 或者手动打开手机「设置」→「辅助功能」→「无障碍」
4. 找到「AssistClient」应用
5. 开启无障碍服务权限
6. 返回应用，点击"刷新"按钮更新状态

### 2. 授予必要权限
应用运行时会请求以下权限：
- **屏幕录制权限**：用于截图功能
- **存储权限**：用于保存截图文件
- **系统窗口权限**：用于悬浮窗功能（如需要）

## 使用方法

### 权限状态检查
1. 打开应用，主界面会自动显示权限状态
2. **绿色卡片**：✓ 无障碍权限已启用 - 可以正常使用所有功能
3. **红色卡片**：⚠ 无障碍权限未启用 - 需要先启用权限

### 测试界面访问
1. 点击主界面的「测试」按钮
2. 如果权限未启用：
   - 会自动弹出权限请求对话框
   - 点击「去设置」直接跳转到无障碍设置页面
3. 如果权限已启用：直接进入测试界面

### 基本操作测试
1. 在测试界面中查看权限状态卡片
2. 无权限时：
   - 所有控制按钮会被禁用且显示为灰色
   - 点击按钮会在日志中显示错误信息
   - 点击「去设置」按钮跳转到设置页面
3. 有权限时：
   - 输入坐标值（X、Y）
   - 点击相应的控制按钮测试功能
   - 查看底部日志了解操作结果

### 坐标系统
- 坐标原点(0,0)位于屏幕左上角
- X轴向右递增，Y轴向下递增
- 可以通过「获取UI」功能查看界面元素的具体坐标

### 截图功能
1. 首次使用需要点击「请求截图权限」按钮
2. 在系统弹窗中选择「立即开始」
3. 之后可以直接使用「截图」按钮
4. 截图文件保存在 `/Pictures/` 目录下

## 技术实现

### 核心组件
- **MainActivity**：主界面，提供任务输入和导航
- **TestActivity**：测试界面，提供手动控制功能
- **DeviceController**：设备控制核心类
- **DeviceAccessibilityService**：无障碍服务实现

### 技术特点
- 使用Android无障碍服务实现手势操作
- 通过MediaProjection实现无Root截图
- 支持获取完整的UI层次结构
- 兼容Android API 24+

## 注意事项

1. **权限要求**：必须启用无障碍服务才能使用控制功能
2. **性能影响**：无障碍服务可能略微影响系统性能
3. **安全考虑**：无障碍服务具有较高权限，请谨慎授权
4. **兼容性**：不同设备的UI结构可能有差异

## 故障排除

### 常见问题
1. **操作无效**：检查是否已启用无障碍服务
2. **截图失败**：确认已授予屏幕录制权限
3. **UI获取失败**：检查当前界面是否支持无障碍访问

### 调试方法
- 查看测试界面底部的操作日志
- 检查Android系统日志中的相关信息
- 确认目标应用支持无障碍功能

## 扩展开发

### 添加新的控制功能
在 `DeviceController.kt` 中添加新的方法，然后在 `TestActivity.kt` 中添加对应的UI控件。

### 集成AI任务执行
在 `MainActivity.kt` 的「执行任务」按钮中实现与后端AI服务的交互逻辑。